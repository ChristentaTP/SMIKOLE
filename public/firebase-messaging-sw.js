/* eslint-disable no-undef */
/**
 * Firebase Cloud Messaging Service Worker
 * Auto-generated by Vite plugin â€” jangan edit manual
 */
importScripts('https://www.gstatic.com/firebasejs/11.8.0/firebase-app-compat.js')
importScripts('https://www.gstatic.com/firebasejs/11.8.0/firebase-messaging-compat.js')

firebase.initializeApp({
  apiKey: "AIzaSyDBN3EObs6BgYA_YkpBIvCTi7GnH7brqXQ",
  authDomain: "smikole-75926.firebaseapp.com",
  projectId: "smikole-75926",
  storageBucket: "smikole-75926.firebasestorage.app",
  messagingSenderId: "55977556270",
  appId: "1:55977556270:web:8a511c1573d84d3292e2bf",
})

const messaging = firebase.messaging()

messaging.onBackgroundMessage((payload) => {
  console.log('[SW] Background message received:', payload)
  const notificationTitle = payload.notification?.title || 'SMIKOLE'
  const notificationOptions = {
    body: payload.notification?.body || 'Anda memiliki notifikasi baru',
    icon: '/logo.svg',
    badge: '/logo.svg',
    tag: payload.data?.notificationId || 'default',
    data: { url: '/notifikasi', ...payload.data }
  }
  self.registration.showNotification(notificationTitle, notificationOptions)
})

self.addEventListener('notificationclick', (event) => {
  event.notification.close()
  const url = event.notification.data?.url || '/notifikasi'
  event.waitUntil(
    clients.matchAll({ type: 'window', includeUncontrolled: true }).then((clientList) => {
      for (const client of clientList) {
        if (client.url.includes(url) && 'focus' in client) return client.focus()
      }
      if (clients.openWindow) return clients.openWindow(url)
    })
  )
})
